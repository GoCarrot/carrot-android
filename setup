#!/bin/bash
set -euo pipefail
IFS=$'\n\t'

brew update

# TODO: Ensure both Brew and Caskroom are set up.
if [ "$(which java)" == "" ]; then
  echo "ERROR: Install JDK first.  Maybe use 'brew cask install java'.  Leaving this to you in case you want to handle this differently."
  exit 1
fi

if [ "$(which ant)" == "" ]; then brew install ant; fi
if [ "$(which mvn)" == "" ]; then brew install maven; fi
if [ "$(which android)" == "" ]; then brew install android-sdk; fi

ANDROID_HOME=$(brew --prefix android-sdk)
export ANDROID_HOME

for COMPONENT in platform-tools tools android-23 build-tools-23.0.2 extra-google-m2repository extra-android-m2repository; do
  if [ ! -e "tmp/.$COMPONENT" ]; then
    echo y | android update sdk --all --no-ui --filter $COMPONENT
    touch tmp/.$COMPONENT
  fi
done
